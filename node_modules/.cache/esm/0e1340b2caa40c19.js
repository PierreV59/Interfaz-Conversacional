let Typo;_caa‍.w("./node_modules/typo-js/typo.js",[["default",["Typo"],function(v){Typo=v}]]);const mysql = require('mysql');
const connectionB = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '',
  database: 'chat'
});

connectionB.connect(function(err) {
  if (err) {
    _caa‍.g.console.error('Error al conectarse a la base de datos: ' + err.stack);
    return;
  }
    _caa‍.g.console.log('Conectado a la base de datos como el ID ' + connectionB.threadId);
});

// Importa el diccionario correcto
const dictionary = new Typo('es_ES', false, false, {
    dictionaryPath: path.join(__dirname, 'node_modules', 'typo-js', 'dictionaries'),
  });

const inputField = document.getElementById('message');

inputField.addEventListener('input', function() {
  const inputValue = inputField.value;
  
  const words = inputValue.split(' ');

  let correctedInput = '';

  for (let i = 0; i < words.length; i++) {
    const word = words[i];
    const isMisspelled = !dictionary.check(word);
    if (isMisspelled) {
      const suggestions = dictionary.suggest(word);
      if (suggestions.length > 0) {
        correctedInput += suggestions[0];
      } else {
        correctedInput += word;
      }
    } else {
      correctedInput += word;
    }
    if (i < words.length - 1) {
      correctedInput += ' ';
    }
  }

  inputField.value = correctedInput;
});

module.exports = function(io) {
    io.on('connection', (socket) => {
    console.log('Un usuario se ha conectado'); 
        
    socket.on('Send message', function (data){
    socket.emit('new message', data);
      try {
        connectionB.query('INSERT INTO messages (incoming_msg_id, outgoing_msg_id, msg) VALUES (?, ?, ?)', [2, 3, data], function(error, results, fields) {
          if (error) throw error;
          console.log('Mensaje insertado correctamente!');
        });
      } catch (error) {
        _caa‍.g.console.log('Error al insertar mensaje:', error);
      }
    });
  });
};

